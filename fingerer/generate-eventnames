#!/usr/bin/perl
use strict;
use warnings;
use FindBin qw($Bin $Script);

# This is the list of events in the system, without the EVENT_ prefix:
my @EVENTS = qw(
   NONE
   ENC_BTN
   ENC_A
   ENC_B
   STOP
   Y_MIN
   X_MIN
   X_MAX
   X_AT_MIN
   MOTOR_ERROR
   RUNNING
   TEST
);



my $enum = "";
my $names = "";
my $nameArray = "";
my $i = 0;

for my $n (@EVENTS) {
    $enum .= "  EVENT_$n = $i,\n";
    my $name = lc $n;
    $names .= qq'static const char NAME_EVENT_${n}[] PROGMEM = "$name";\n';
        
    $nameArray .= qq'  NAME_EVENT_$n,\n';

    $i++;
}

$nameArray =~ s/,\n$//;


open H, ">$Bin/eventnames.h" or die;

print H qq'
#pragma once

// Do not edit this file it is generated by $Script so your changes will be lost!

typedef enum {
$enum

  EVENTS_USED,
  EVENT_ACTIVE = 128,
} Event;
';
close H;

open C, ">$Bin/eventnames.cpart" or die;
print C qq'
// Do not edit this file it is generated by $Script so your changes will be lost!
$names

static const PGM_P const EVENT_NAMES[EVENTS_USED] PROGMEM = {
$nameArray
};
';
close C;
